import { __assign, __decorate } from "tslib";
import { Component, ViewChild } from '@angular/core';
import { UciService } from '../../services/uci.service';
import { Router } from '@angular/router';
import { GlobalService } from '../../services/global.service';
import { Helper } from '../../utils/helper';
var ConversationListComponent = /** @class */ (function () {
    function ConversationListComponent(uciService, router, globalService) {
        this.uciService = uciService;
        this.router = router;
        this.globalService = globalService;
        this.chatBots = [];
        this.displayedColumns = ['name', 'status', 'description', 'startingMessage', 'botUrl', 'botId', 'action'];
        this.pager = {
            pageSizeOptions: [5, 10, 25, 30],
            currentPage: 1,
            totalItems: 0,
            pageSize: 10
        };
        this.column = '';
        this.sortDirection = '';
        this.reverse = false;
    }
    ConversationListComponent.prototype.ngOnInit = function () {
        this.user = this.globalService.getUser();
        if (!this.user) {
            this.router.navigate(['uci-admin']);
            return;
        }
        this.resourceService = this.globalService.getResourceService();
        this.getAllChatBots();
    };
    ConversationListComponent.prototype.getAllChatBots = function () {
        var _this = this;
        var param = {
            page: this.pager.currentPage,
            perPage: this.pager.pageSize
        };
        if (this.search) {
            param.name = this.search;
        }
        this.uciService.searchConversation(param).subscribe(function (data) { return _this.parseConversations(data); });
    };
    ConversationListComponent.prototype.parseConversations = function (data) {
        var _this = this;
        this.chatBots = [];
        data.data.forEach(function (bot) {
            var obj = __assign(__assign({}, bot), { segmentText: '', userCount: 0, status: bot.status || 'Draft' });
            obj.status = bot.status === 'enabled' ? 'Live' : bot.status === 'disabled' ? 'Disabled' : 'Draft';
            var segmentNames = [];
            // bot.userSegments.forEach(userSegment => {
            //     segmentNames.push(userSegment.name);
            //     obj.userCount += (userSegment.count || 0);
            // });
            obj.segmentText = segmentNames.join(', ');
            obj.url = Helper.makBotUrl(bot.startingMessage || '', _this.globalService.getBotPhoneNumber());
            obj.botId = bot.id || '';
            _this.chatBots.push(obj);
        });
        this.pager.totalItems = data.totalCount;
    };
    ConversationListComponent.prototype.sortColumns = function (column) {
        this.column = column;
        this.sortDirection = this.sortDirection === 'asc' ? 'desc' : 'asc';
        this.reverse = !this.reverse;
    };
    ConversationListComponent.prototype.navigateToPage = function (pageEvent) {
        this.pager.currentPage = pageEvent.pageIndex + 1;
        this.getAllChatBots();
    };
    ConversationListComponent.prototype.getSearch = function () {
        this.pager.currentPage = 1;
        this.getAllChatBots();
    };
    ConversationListComponent.prototype.onAddNew = function () {
        this.router.navigateByUrl('uci-admin/add');
    };
    ConversationListComponent.prototype.onEdit = function (conversation) {
        this.router.navigateByUrl("uci-admin/" + conversation.id + "/edit");
    };
    ConversationListComponent.prototype.onStatusChange = function (conversation, index) {
        var _this = this;
        if (conversation.status === 'Live') {
            this.uciService.pauseConversation(conversation.id).subscribe(function (data) {
                _this.chatBots[index].status = 'Disabled';
                _this.updateDatasource();
            });
        }
        else {
            this.uciService.startConversation(conversation.id).subscribe(function (data) {
                _this.chatBots[index].status = 'Live';
                _this.updateDatasource();
            });
        }
    };
    ConversationListComponent.prototype.onDelete = function (conversation, index) {
        var _this = this;
        this.uciService.deleteConversation(conversation.id).subscribe(function (data) {
            _this.chatBots.splice(index, 1);
            _this.updateDatasource();
        });
    };
    ConversationListComponent.prototype.onCopy = function (id) {
        Helper.copyData(id);
    };
    ConversationListComponent.prototype.updateDatasource = function () {
        this.botTable.renderRows();
    };
    ConversationListComponent.prototype.onReport = function (conversation, i) {
        this.router.navigateByUrl("uci-admin/" + conversation.id + "/reports");
    };
    ConversationListComponent.ctorParameters = function () { return [
        { type: UciService },
        { type: Router },
        { type: GlobalService }
    ]; };
    __decorate([
        ViewChild('botTable')
    ], ConversationListComponent.prototype, "botTable", void 0);
    ConversationListComponent = __decorate([
        Component({
            selector: 'lib-conversation-list',
            template: "<div class=\"uci-container\">\n    <mat-grid-list cols=\"2\" rowHeight=\"4rem\">\n        <mat-grid-tile colspan=\"1\">\n            <div class=\"w-100 text-left\">\n                <mat-form-field>\n                    <input matInput type=\"text\" [(ngModel)]=\"search\"\n                           [placeholder]=\"resourceService.frmelmnts?.btn?.search\"\n                           (keyup.enter)=\"getSearch()\">\n                    <button mat-button matSuffix mat-stroked-button aria-label=\"search\"\n                            class=\"uci-action-button computer only\" (click)=\"getSearch()\">\n<!--                        <mat-icon>search</mat-icon>-->\n                        {{resourceService.frmelmnts?.btn?.search}}\n                    </button>\n                </mat-form-field>\n            </div>\n        </mat-grid-tile>\n        <mat-grid-tile colspan=\"1\">\n            <div class=\"pb-10 text-right w-100\">\n                <div class=\"right-floated pt-0\">\n                    <button mat-raised-button class=\"uci-action-button\"\n                            (click)=\"onAddNew()\"> {{resourceService.frmelmnts?.btn?.addNew}} </button>\n                </div>\n            </div>\n        </mat-grid-tile>\n    </mat-grid-list>\n\n    <mat-grid-list cols=\"1\">\n        <table mat-table class=\"computer only\" [dataSource]=\"chatBots\" #botTable>\n            <ng-container matColumnDef=\"name\">\n                <th mat-header-cell *matHeaderCellDef> {{resourceService.frmelmnts?.lbl?.name}}</th>\n                <td mat-cell *matCellDef=\"let element\"> {{element.name}} </td>\n            </ng-container>\n            <ng-container matColumnDef=\"status\">\n                <th mat-header-cell *matHeaderCellDef> {{resourceService.frmelmnts?.lbl?.status}} </th>\n                <td mat-cell *matCellDef=\"let element\"\n                    [ngClass]=\"'status-' + (element.status ? element.status.toLowerCase(): '')\"> {{element.status}} </td>\n            </ng-container>\n            <ng-container matColumnDef=\"description\">\n                <th mat-header-cell *matHeaderCellDef> {{resourceService.frmelmnts?.lbl?.description}}</th>\n                <td mat-cell *matCellDef=\"let element\"> {{element.description}} </td>\n            </ng-container>\n            <ng-container matColumnDef=\"startingMessage\">\n                <th mat-header-cell *matHeaderCellDef> {{resourceService.frmelmnts?.lbl?.startingMessage}} </th>\n                <td mat-cell *matCellDef=\"let element\"> {{element.startingMessage}} </td>\n            </ng-container>\n            <ng-container matColumnDef=\"botUrl\">\n                <th mat-header-cell *matHeaderCellDef> {{resourceService.frmelmnts?.lbl?.botUrl}} </th>\n                <td mat-cell *matCellDef=\"let element; let i = index\">\n                    <span class=\"hide\" [id]=\"'copyUrl-' + i\">{{element.url}}</span>\n                    <button mat-raised-button class=\"uci-copy-button\"\n                            (click)=\"onCopy('copyUrl-' + i)\">\n                        {{resourceService.frmelmnts?.btn?.copy}}\n                    </button>\n                </td>\n            </ng-container>\n            <ng-container matColumnDef=\"botId\">\n                <th mat-header-cell *matHeaderCellDef> {{resourceService.frmelmnts?.lbl?.botId}}</th>\n                <td mat-cell *matCellDef=\"let element; let i = index\">\n                    <span class=\"hide\" [id]=\"'copyId-' + i\">{{element.id}}</span>\n                    <button mat-raised-button class=\"uci-copy-button\"\n                            (click)=\"onCopy('copyId-' + i)\">\n                        {{resourceService.frmelmnts?.btn?.copy}}\n                    </button>\n                </td>\n            </ng-container>\n            <ng-container matColumnDef=\"action\">\n                <th mat-header-cell *matHeaderCellDef> {{resourceService.frmelmnts?.lbl?.action}}</th>\n                <td mat-cell *matCellDef=\"let element; let i = index\" class=\"center aligned\">\n                    <button mat-button [matMenuTriggerFor]=\"menu\">\n                        <mat-icon>more_vert</mat-icon>\n                    </button>\n                    <mat-menu #menu=\"matMenu\" class=\"uci-list-menu\">\n                        <button mat-menu-item (click)=\"onEdit(element)\">{{resourceService.frmelmnts?.lbl?.edit}} </button>\n                        <button mat-menu-item (click)=\"onDelete(element, i)\">{{resourceService.frmelmnts?.lbl?.delete}} </button>\n                        <button mat-menu-item (click)=\"onStatusChange(element, i)\">\n                            {{element.status === 'Live' ? resourceService.frmelmnts?.lbl?.disable : resourceService.frmelmnts?.lbl?.enable}}\n                        </button>\n                        <button mat-menu-item (click)=\"onReport(element, i)\">\n                            {{resourceService.frmelmnts?.lbl?.report}}\n                        </button>\n                    </mat-menu>\n                </td>\n            </ng-container>\n            <tr mat-header-row *matHeaderRowDef=\"displayedColumns\"></tr>\n            <tr mat-row *matRowDef=\"let row; columns: displayedColumns;\"></tr>\n        </table>\n\n        <div class=\"mobile only\">\n            <div *ngFor=\"let chatBot of chatBots; let i = index\" class=\"mb-5\">\n                <mat-card>\n                    <mat-card-content>\n                        <mat-grid-list cols=\"4\" rowHeight=\"35\">\n                            <mat-grid-tile colspan=\"1\">\n                                <div class=\"w-100 text-left\">{{resourceService.frmelmnts?.lbl?.name}}</div>\n                            </mat-grid-tile>\n                            <mat-grid-tile colspan=\"3\" class=\"overflow-visible\">\n                                <div class=\"w-100 d-flex justify-between align-middle\">\n                                    <h5>{{chatBot.name}}</h5>\n                                    <button mat-button [matMenuTriggerFor]=\"menuMobile\">\n                                        <mat-icon>more_vert</mat-icon>\n                                    </button>\n                                    <mat-menu #menuMobile=\"matMenu\" class=\"uci-list-menu\">\n                                        <button mat-menu-item (click)=\"onEdit(chatBot)\">{{resourceService.frmelmnts?.lbl?.edit}} </button>\n                                        <button mat-menu-item (click)=\"onDelete(chatBot, i)\">{{resourceService.frmelmnts?.lbl?.delete}} </button>\n                                        <button mat-menu-item (click)=\"onStatusChange(chatBot, i)\">\n                                            {{chatBot.status === 'Live' ? resourceService.frmelmnts?.lbl?.disable : resourceService.frmelmnts?.lbl?.enable}}\n                                        </button>\n                                        <button mat-menu-item (click)=\"onReport(chatBot, i)\">\n                                            {{resourceService.frmelmnts?.lbl?.report}}\n                                        </button>\n                                    </mat-menu>\n                                </div>\n                            </mat-grid-tile>\n                            <mat-grid-tile colspan=\"1\">\n                                <div class=\"w-100 text-left\">{{resourceService.frmelmnts?.lbl?.description}}</div>\n                            </mat-grid-tile>\n                            <mat-grid-tile colspan=\"3\">\n                                <div class=\"w-100 text-left\">\n                                    {{chatBot.description}}\n                                </div>\n                            </mat-grid-tile>\n                            <mat-grid-tile colspan=\"1\">\n                                <div class=\"w-100 text-left\">{{resourceService.frmelmnts?.lbl?.startingMessage}}</div>\n                            </mat-grid-tile>\n                            <mat-grid-tile colspan=\"3\">\n                                <div class=\"w-100 d-flex justify-between align-middle\">\n                                    <span>{{chatBot.startingMessage}}</span>\n                                    <span>\n                                        <button mat-flat-button class=\"small-btn\"\n                                                [ngClass]=\"'status-' + (chatBot.status ? chatBot.status.toLowerCase(): '')\">\n                                            {{chatBot.status}}\n                                        </button>\n                                    </span>\n                                </div>\n                            </mat-grid-tile>\n                        </mat-grid-list>\n                    </mat-card-content>\n                </mat-card>\n            </div>\n        </div>\n        <div class=\"uci-mat-pagination\">\n            <mat-paginator [length]=\"pager.totalItems\"\n                           [pageSize]=\"pager.pageSize\"\n                           [pageIndex]=\"pager.currentPage - 1\"\n                           [pageSizeOptions]=\"pager.pageSizeOptions\"\n                           (page)=\"navigateToPage($event)\">\n            </mat-paginator>\n        </div>\n    </mat-grid-list>\n</div>\n",
            styles: ["@import url(https://fonts.googleapis.com/css?family=Material+Icons);.uci-container ::ng-deep .mat-form-field-appearance-outline .mat-form-field-outline{background-color:#fff;border-radius:5px}.mat-table{width:100%}.mat-header-cell{font-weight:700;color:#000}.uci-action-button{background-color:#005a9e;color:#fff}.uci-copy-button{background-color:#e0e1e2;color:#000}.hide{display:none}.asterisk-color{color:red}.uci-mat-pagination{text-align:right}.small-btn{padding:6px 14px;font-size:12px;line-height:1;min-width:auto}.w-100{width:100%}.justify-between{justify-content:space-between}.align-middle{align-items:center}.overflow-visible{overflow:visible!important}.background-transparent{background:0 0!important}.wrap-text{word-wrap:break-word}.col-3{flex-grow:3}.col-1{flex-grow:1}.d-flex{display:flex}.flex-row{flex-flow:row!important}.flex-column{flex-flow:column!important}.justify-content-center{justify-content:center!important}.justify-content-start{justify-content:start!important}.justify-content-end{justify-content:end!important}.justify-content-around{justify-content:space-around!important}.justify-content-between{justify-content:space-between!important}.align-items-center{align-items:center!important}.align-items-start{align-items:start!important}.align-items-baseline{align-items:baseline!important}.align-items-end{align-items:end!important}.text-center{text-align:center!important}.text-left{text-align:left!important}.text-right{text-align:right!important}.text-right .margin-auto{margin:auto!important}::ng-deep .mat-select-panel-wrap{flex-basis:auto}.mat-column-action{width:5px}.uci-list-menu{background:red}.uci-container ::ng-deep .cdk-overlay-pane{width:auto}.ellipsis-icon{font-size:1.2rem}.status-live{color:#3c763d}.status-draft{color:#ffb300}.status-disabled{color:#ff4a2f}.mobile .status-draft{font-weight:900;background-color:rgba(241,210,140,.69)}.mobile .status-disabled{font-weight:900;background-color:rgba(229,135,126,.63)}.mobile .status-live{font-weight:900;background-color:rgba(120,206,122,.58)}.action-dropdown{top:2px;left:-56px;z-index:2;position:absolute}.action-dropdown .item{cursor:pointer}.action-dropdown .item:hover{background-color:#f6f6f6}"]
        })
    ], ConversationListComponent);
    return ConversationListComponent;
}());
export { ConversationListComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29udmVyc2F0aW9uLWxpc3QuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQHNhbWFncmEteC91Y2ktY29uc29sZS8iLCJzb3VyY2VzIjpbImxpYi9jb21wb25lbnRzL2NvbnZlcnNhdGlvbi1saXN0L2NvbnZlcnNhdGlvbi1saXN0LmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxFQUFDLFNBQVMsRUFBVSxTQUFTLEVBQUMsTUFBTSxlQUFlLENBQUM7QUFDM0QsT0FBTyxFQUFDLFVBQVUsRUFBQyxNQUFNLDRCQUE0QixDQUFDO0FBQ3RELE9BQU8sRUFBQyxNQUFNLEVBQUMsTUFBTSxpQkFBaUIsQ0FBQztBQUN2QyxPQUFPLEVBQUMsYUFBYSxFQUFDLE1BQU0sK0JBQStCLENBQUM7QUFDNUQsT0FBTyxFQUFDLE1BQU0sRUFBQyxNQUFNLG9CQUFvQixDQUFDO0FBUTFDO0lBa0JJLG1DQUNZLFVBQXNCLEVBQ3RCLE1BQWMsRUFDZCxhQUE0QjtRQUY1QixlQUFVLEdBQVYsVUFBVSxDQUFZO1FBQ3RCLFdBQU0sR0FBTixNQUFNLENBQVE7UUFDZCxrQkFBYSxHQUFiLGFBQWEsQ0FBZTtRQW5CeEMsYUFBUSxHQUFHLEVBQUUsQ0FBQztRQUNkLHFCQUFnQixHQUFhLENBQUMsTUFBTSxFQUFFLFFBQVEsRUFBRSxhQUFhLEVBQUUsaUJBQWlCLEVBQUUsUUFBUSxFQUFFLE9BQU8sRUFBRSxRQUFRLENBQUMsQ0FBQztRQUMvRyxVQUFLLEdBQUc7WUFDSixlQUFlLEVBQUUsQ0FBQyxDQUFDLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLENBQUM7WUFDaEMsV0FBVyxFQUFFLENBQUM7WUFDZCxVQUFVLEVBQUUsQ0FBQztZQUNiLFFBQVEsRUFBRSxFQUFFO1NBQ2YsQ0FBQztRQUNGLFdBQU0sR0FBRyxFQUFFLENBQUM7UUFDWixrQkFBYSxHQUFHLEVBQUUsQ0FBQztRQUNuQixZQUFPLEdBQUcsS0FBSyxDQUFDO0lBV2hC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S0FBSztRQUE1QixpQkFPQztRQU5HLElBQUksQ0FBQyxVQUFVLENBQUMsa0JBQWtCLENBQUMsWUFBWSxDQUFDLEVBQUUsQ0FBQyxDQUFDLFNBQVMsQ0FDekQsVUFBQSxJQUFJO1lBQ0EsS0FBSSxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsS0FBSyxFQUFFLENBQUMsQ0FBQyxDQUFDO1lBQy9CLEtBQUksQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDO1FBQzVCLENBQUMsQ0FDSixDQUFDO0lBQ04sQ0FBQztJQUVELDBDQUFNLEdBQU4sVUFBTyxFQUFFO1FBQ0wsTUFBTSxDQUFDLFFBQVEsQ0FBQyxFQUFFLENBQUMsQ0FBQztJQUN4QixDQUFDO0lBRUQsb0RBQWdCLEdBQWhCO1FBQ0ksSUFBSSxDQUFDLFFBQVEsQ0FBQyxVQUFVLEVBQUUsQ0FBQztJQUMvQixDQUFDO0lBRUQsNENBQVEsR0FBUixVQUFTLFlBQVksRUFBRSxDQUFDO1FBQ3BCLElBQUksQ0FBQyxNQUFNLENBQUMsYUFBYSxDQUFDLGVBQWEsWUFBWSxDQUFDLEVBQUUsYUFBVSxDQUFDLENBQUM7SUFDdEUsQ0FBQzs7Z0JBaEh1QixVQUFVO2dCQUNkLE1BQU07Z0JBQ0MsYUFBYTs7SUFwQmpCO1FBQXRCLFNBQVMsQ0FBQyxVQUFVLENBQUM7K0RBQXlCO0lBRHRDLHlCQUF5QjtRQUxyQyxTQUFTLENBQUM7WUFDUCxRQUFRLEVBQUUsdUJBQXVCO1lBQ2pDLDJsU0FBaUQ7O1NBRXBELENBQUM7T0FDVyx5QkFBeUIsQ0FvSXJDO0lBQUQsZ0NBQUM7Q0FBQSxBQXBJRCxJQW9JQztTQXBJWSx5QkFBeUIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge0NvbXBvbmVudCwgT25Jbml0LCBWaWV3Q2hpbGR9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHtVY2lTZXJ2aWNlfSBmcm9tICcuLi8uLi9zZXJ2aWNlcy91Y2kuc2VydmljZSc7XG5pbXBvcnQge1JvdXRlcn0gZnJvbSAnQGFuZ3VsYXIvcm91dGVyJztcbmltcG9ydCB7R2xvYmFsU2VydmljZX0gZnJvbSAnLi4vLi4vc2VydmljZXMvZ2xvYmFsLnNlcnZpY2UnO1xuaW1wb3J0IHtIZWxwZXJ9IGZyb20gJy4uLy4uL3V0aWxzL2hlbHBlcic7XG5pbXBvcnQge01hdFRhYmxlfSBmcm9tICdAYW5ndWxhci9tYXRlcmlhbC90YWJsZSc7XG5cbkBDb21wb25lbnQoe1xuICAgIHNlbGVjdG9yOiAnbGliLWNvbnZlcnNhdGlvbi1saXN0JyxcbiAgICB0ZW1wbGF0ZVVybDogJy4vY29udmVyc2F0aW9uLWxpc3QuY29tcG9uZW50Lmh0bWwnLFxuICAgIHN0eWxlVXJsczogWycuL2NvbnZlcnNhdGlvbi1saXN0LmNvbXBvbmVudC5zY3NzJ11cbn0pXG5leHBvcnQgY2xhc3MgQ29udmVyc2F0aW9uTGlzdENvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCB7XG4gICAgQFZpZXdDaGlsZCgnYm90VGFibGUnKSBib3RUYWJsZTogTWF0VGFibGU8YW55PjtcbiAgICBjaGF0Qm90cyA9IFtdO1xuICAgIGRpc3BsYXllZENvbHVtbnM6IHN0cmluZ1tdID0gWyduYW1lJywgJ3N0YXR1cycsICdkZXNjcmlwdGlvbicsICdzdGFydGluZ01lc3NhZ2UnLCAnYm90VXJsJywgJ2JvdElkJywgJ2FjdGlvbiddO1xuICAgIHBhZ2VyID0ge1xuICAgICAgICBwYWdlU2l6ZU9wdGlvbnM6IFs1LCAxMCwgMjUsIDMwXSxcbiAgICAgICAgY3VycmVudFBhZ2U6IDEsXG4gICAgICAgIHRvdGFsSXRlbXM6IDAsXG4gICAgICAgIHBhZ2VTaXplOiAxMFxuICAgIH07XG4gICAgY29sdW1uID0gJyc7XG4gICAgc29ydERpcmVjdGlvbiA9ICcnO1xuICAgIHJldmVyc2UgPSBmYWxzZTtcbiAgICBxdWVyeVBhcmFtczogYW55O1xuICAgIHNlYXJjaDtcbiAgICB1c2VyO1xuICAgIHJlc291cmNlU2VydmljZTtcblxuICAgIGNvbnN0cnVjdG9yKFxuICAgICAgICBwcml2YXRlIHVjaVNlcnZpY2U6IFVjaVNlcnZpY2UsXG4gICAgICAgIHByaXZhdGUgcm91dGVyOiBSb3V0ZXIsXG4gICAgICAgIHByaXZhdGUgZ2xvYmFsU2VydmljZTogR2xvYmFsU2VydmljZSxcbiAgICApIHtcbiAgICB9XG5cbiAgICBuZ09uSW5pdCgpIHtcbiAgICAgICAgdGhpcy51c2VyID0gdGhpcy5nbG9iYWxTZXJ2aWNlLmdldFVzZXIoKTtcbiAgICAgICAgaWYgKCF0aGlzLnVzZXIpIHtcbiAgICAgICAgICAgIHRoaXMucm91dGVyLm5hdmlnYXRlKFsndWNpLWFkbWluJ10pO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMucmVzb3VyY2VTZXJ2aWNlID0gdGhpcy5nbG9iYWxTZXJ2aWNlLmdldFJlc291cmNlU2VydmljZSgpO1xuICAgICAgICB0aGlzLmdldEFsbENoYXRCb3RzKCk7XG4gICAgfVxuXG4gICAgZ2V0QWxsQ2hhdEJvdHMoKSB7XG4gICAgICAgIGNvbnN0IHBhcmFtOiBhbnkgPSB7XG4gICAgICAgICAgICBwYWdlOiB0aGlzLnBhZ2VyLmN1cnJlbnRQYWdlLFxuICAgICAgICAgICAgcGVyUGFnZTogdGhpcy5wYWdlci5wYWdlU2l6ZVxuICAgICAgICB9O1xuXG4gICAgICAgIGlmICh0aGlzLnNlYXJjaCkge1xuICAgICAgICAgICAgcGFyYW0ubmFtZSA9IHRoaXMuc2VhcmNoO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMudWNpU2VydmljZS5zZWFyY2hDb252ZXJzYXRpb24ocGFyYW0pLnN1YnNjcmliZShcbiAgICAgICAgICBkYXRhID0+IHRoaXMucGFyc2VDb252ZXJzYXRpb25zKGRhdGEpXG4gICAgICAgICk7XG5cbiAgICB9XG5cbiAgICBwYXJzZUNvbnZlcnNhdGlvbnMoZGF0YSkge1xuICAgICAgICB0aGlzLmNoYXRCb3RzID0gW107XG4gICAgICAgIGRhdGEuZGF0YS5mb3JFYWNoKGJvdCA9PiB7XG4gICAgICAgICAgICBjb25zdCBvYmogPSB7Li4uYm90LCBzZWdtZW50VGV4dDogJycsIHVzZXJDb3VudDogMCwgc3RhdHVzOiBib3Quc3RhdHVzIHx8ICdEcmFmdCd9O1xuICAgICAgICAgICAgb2JqLnN0YXR1cyA9IGJvdC5zdGF0dXMgPT09ICdlbmFibGVkJyA/ICdMaXZlJyA6IGJvdC5zdGF0dXMgPT09ICdkaXNhYmxlZCcgPyAnRGlzYWJsZWQnIDogJ0RyYWZ0JztcbiAgICAgICAgICAgIGNvbnN0IHNlZ21lbnROYW1lcyA9IFtdO1xuICAgICAgICAgICAgLy8gYm90LnVzZXJTZWdtZW50cy5mb3JFYWNoKHVzZXJTZWdtZW50ID0+IHtcbiAgICAgICAgICAgIC8vICAgICBzZWdtZW50TmFtZXMucHVzaCh1c2VyU2VnbWVudC5uYW1lKTtcbiAgICAgICAgICAgIC8vICAgICBvYmoudXNlckNvdW50ICs9ICh1c2VyU2VnbWVudC5jb3VudCB8fCAwKTtcbiAgICAgICAgICAgIC8vIH0pO1xuICAgICAgICAgICAgb2JqLnNlZ21lbnRUZXh0ID0gc2VnbWVudE5hbWVzLmpvaW4oJywgJyk7XG5cbiAgICAgICAgICAgIG9iai51cmwgPSBIZWxwZXIubWFrQm90VXJsKGJvdC5zdGFydGluZ01lc3NhZ2UgfHwgJycsIHRoaXMuZ2xvYmFsU2VydmljZS5nZXRCb3RQaG9uZU51bWJlcigpKTtcbiAgICAgICAgICAgIG9iai5ib3RJZCA9IGJvdC5pZCB8fCAnJztcblxuICAgICAgICAgICAgdGhpcy5jaGF0Qm90cy5wdXNoKG9iaik7XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLnBhZ2VyLnRvdGFsSXRlbXMgPSBkYXRhLnRvdGFsQ291bnQ7XG4gICAgfVxuXG4gICAgc29ydENvbHVtbnMoY29sdW1uKSB7XG4gICAgICAgIHRoaXMuY29sdW1uID0gY29sdW1uO1xuICAgICAgICB0aGlzLnNvcnREaXJlY3Rpb24gPSB0aGlzLnNvcnREaXJlY3Rpb24gPT09ICdhc2MnID8gJ2Rlc2MnIDogJ2FzYyc7XG4gICAgICAgIHRoaXMucmV2ZXJzZSA9ICF0aGlzLnJldmVyc2U7XG4gICAgfVxuXG4gICAgbmF2aWdhdGVUb1BhZ2UocGFnZUV2ZW50KTogdm9pZCB7XG4gICAgICAgIHRoaXMucGFnZXIuY3VycmVudFBhZ2UgPSBwYWdlRXZlbnQucGFnZUluZGV4ICsgMTtcbiAgICAgICAgdGhpcy5nZXRBbGxDaGF0Qm90cygpO1xuICAgIH1cblxuICAgIGdldFNlYXJjaCgpIHtcbiAgICAgICAgdGhpcy5wYWdlci5jdXJyZW50UGFnZSA9IDE7XG4gICAgICAgIHRoaXMuZ2V0QWxsQ2hhdEJvdHMoKTtcbiAgICB9XG5cbiAgICBvbkFkZE5ldygpIHtcbiAgICAgICAgdGhpcy5yb3V0ZXIubmF2aWdhdGVCeVVybCgndWNpLWFkbWluL2FkZCcpO1xuICAgIH1cblxuICAgIG9uRWRpdChjb252ZXJzYXRpb24pIHtcbiAgICAgICAgdGhpcy5yb3V0ZXIubmF2aWdhdGVCeVVybChgdWNpLWFkbWluLyR7Y29udmVyc2F0aW9uLmlkfS9lZGl0YCk7XG4gICAgfVxuXG4gICAgb25TdGF0dXNDaGFuZ2UoY29udmVyc2F0aW9uLCBpbmRleCkge1xuICAgICAgICBpZiAoY29udmVyc2F0aW9uLnN0YXR1cyA9PT0gJ0xpdmUnKSB7XG4gICAgICAgICAgICB0aGlzLnVjaVNlcnZpY2UucGF1c2VDb252ZXJzYXRpb24oY29udmVyc2F0aW9uLmlkKS5zdWJzY3JpYmUoXG4gICAgICAgICAgICAgICAgZGF0YSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY2hhdEJvdHNbaW5kZXhdLnN0YXR1cyA9ICdEaXNhYmxlZCc7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlRGF0YXNvdXJjZSgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLnVjaVNlcnZpY2Uuc3RhcnRDb252ZXJzYXRpb24oY29udmVyc2F0aW9uLmlkKS5zdWJzY3JpYmUoXG4gICAgICAgICAgICAgICAgZGF0YSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY2hhdEJvdHNbaW5kZXhdLnN0YXR1cyA9ICdMaXZlJztcbiAgICAgICAgICAgICAgICAgICAgdGhpcy51cGRhdGVEYXRhc291cmNlKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIG9uRGVsZXRlKGNvbnZlcnNhdGlvbiwgaW5kZXgpIHtcbiAgICAgICAgdGhpcy51Y2lTZXJ2aWNlLmRlbGV0ZUNvbnZlcnNhdGlvbihjb252ZXJzYXRpb24uaWQpLnN1YnNjcmliZShcbiAgICAgICAgICAgIGRhdGEgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuY2hhdEJvdHMuc3BsaWNlKGluZGV4LCAxKTtcbiAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZURhdGFzb3VyY2UoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgKTtcbiAgICB9XG5cbiAgICBvbkNvcHkoaWQpIHtcbiAgICAgICAgSGVscGVyLmNvcHlEYXRhKGlkKTtcbiAgICB9XG5cbiAgICB1cGRhdGVEYXRhc291cmNlKCkge1xuICAgICAgICB0aGlzLmJvdFRhYmxlLnJlbmRlclJvd3MoKTtcbiAgICB9XG5cbiAgICBvblJlcG9ydChjb252ZXJzYXRpb24sIGkpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5yb3V0ZXIubmF2aWdhdGVCeVVybChgdWNpLWFkbWluLyR7Y29udmVyc2F0aW9uLmlkfS9yZXBvcnRzYCk7XG4gICAgfVxufVxuIl19